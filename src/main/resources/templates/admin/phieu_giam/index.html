<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="/admin/fragments/head :: head" xmlns:th="http://www.thymeleaf.org">

</head>
<!-- Site wrapper -->
<div class="wrapper">
    <!-- </header>-->
    <div>
        <!--        <header th:replace="/admin/fragments/header :: header">-->
    </div>

    <!-- Sidebar -->
    <div>
        <aside th:replace="/admin/fragments/sidebar :: sidebar"></aside>
    </div>

    <!-- Main-->
    <div id="main">
        <header class="mb-3">
            <a href="#" class="burger-btn d-block d-xl-none">
                <i class="bi bi-justify fs-3"></i>
            </a>
        </header>
        <div class="page-heading">
            <div class="page-title">
                <div class="row">
                    <div class="col-12 col-md-6 order-md-1 order-last">
                        <h3>Danh sách phiếu giảm giá</h3>
<!--                        <p class="text-subtitle text-muted">các sản phẩm quạt</p>-->
                    </div>
                    <div class="col-12 col-md-6 order-md-2 order-first">
                        <nav aria-label="breadcrumb" class="breadcrumb-header float-start float-lg-end">
                            <ol class="breadcrumb">
                                <li class="breadcrumb-item"><a href="/admin/index">Home</a></li>
                                <li class="breadcrumb-item active" aria-current="page"><a href="/admin/phieu-giam/index">Quản lý phiếu giảm </a></li>
                            </ol>
                        </nav>
                    </div>
                </div>
            </div>
        </div>

        <div class="page-content">
            <section class="row">
                <section class="section">
                    <div class="card">
                        <div class="card-header">
                           <a th:href="@{/admin/phieu-giam/store}"><button class="btn btn-primary">Thêm mới</button></a>
                        </div>
                        <div class="card-body">
                            <div class="row g-3 mb-3">
                                <div class="col-md-8">
                                    <form action="/admin/phieu-giam/index" method="GET" class="d-flex">
                                        <input type="text" class="form-control me-2" name="keyword"
                                               placeholder="Tìm kiếm theo tên">
                                        <button type="submit" class="btn btn-primary">Tìm kiếm</button>
                                    </form>
                                </div>
                                <div class="col-md-4">
                                    <form action="/admin/phieu-giam/index" method="GET" class="d-flex">
                                        <select class="form-control me-2" name="status">
                                            <option value="">Tất cả trạng thái</option>
                                            <option value="true" th:selected="${param.status == 'true'}">Hoạt động</option>
                                            <option value="false" th:selected="${param.status == 'false'}">Không hoạt động</option>
                                        </select>
                                        <button type="submit" class="btn btn-primary">Lọc</button>
                                    </form>
                                </div>
                            </div>
                            <div class="table-responsive">
                                <table class="table table-bordered table-hover">
                                    <thead class="thead-light">
                                    <tr>
                                        <th>Mã phiếu giảm giá</th>
                                        <th>Tên phiếu giảm giá</th>
                                        <th>Ngày bắt đầu</th>
                                        <th>Ngày kết thúc</th>
                                        <th>Số lượng</th>
                                        <th>Trạng thái</th>
                                        <th>Chi tiết</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr th:each="pgg : ${ListPGG}" style="cursor: pointer;">
                                        <td th:text="${pgg.ma}">Mã phiếu giảm</td>
                                        <td th:text="${pgg.ten}">Tên phiếu giảm</td>
                                        <td th:text="${pgg.ngayBD}">Ngày bắt đầu</td>
                                        <td th:text="${pgg.ngayKT}">Ngày kết thúc</td>
                                        <td th:text="${pgg.soLuong}">Số lượng</td>
                                        <td th:text="${pgg.trangThai} == true ? 'Hoạt động' : 'Không hoạt động'">Trạng
                                            thái
                                        </td>
                                        <td><a th:href="@{/admin/phieu-giam/edit/{id}(id=${pgg.id})}">Chi
                                            tiết</a></td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                            <nav aria-label="Page navigation example">
                                <ul class="pagination">
                                    <li class="page-item ${currentPage == 0 ? 'disabled' : ''}">
                                        <a class="page-link"
                                           th:href="@{/admin/phieu-giam/index(page=${currentPage - 1})}">Previous</a>
                                    </li>
                                    <li th:each="i : ${#numbers.sequence(0, totalPages - 1)}"
                                        th:classappend="${currentPage == i ? 'page-item active' : 'page-item'}">
                                        <a class="page-link"
                                           th:href="@{/admin/phieu-giam/index(page=${i})}">[[${i + 1}]]</a>
                                    </li>
                                    <li class="page-item ${currentPage == totalPages - 1 ? 'disabled' : ''}">
                                        <a class="page-link"
                                           th:href="@{/admin/phieu-giam/index(page=${currentPage + 1})}">Next</a>
                                    </li>
                                </ul>
                            </nav>
                        </div>
                    </div>

                </section>
            </section>
        </div>
    </div>
    <!-- Footer-->
    <div>
        <footer th:replace="/admin/fragments/footer :: footer"></footer>
    </div>

</div>
<form id="editPriceForm" method="post" action="/admin/san-pham/updatePrice" style="display: none;">
    <input type="hidden" name="id" id="editPriceId">
    <input type="number" name="newPrice" id="editPriceInput" class="form-control">
    <button type="submit" class="btn btn-primary">Lưu</button>
    <button type="button" class="btn btn-secondary" id="cancelEditPrice">Hủy</button>
</form>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        var prevLink = document.querySelector('.pagination .page-item.disabled a[aria-label="Previous"]');
        var nextLink = document.querySelector('.pagination .page-item.disabled a[aria-label="Next"]');

        if (prevLink) {
            prevLink.addEventListener('click', function (event) {
                event.preventDefault();
            });
        }

        if (nextLink) {
            nextLink.addEventListener('click', function (event) {
                event.preventDefault();
            });
        }
        //Sửa giá
        var editButtons = document.querySelectorAll('.edit-price-btn');
        var editPriceForm = document.getElementById('editPriceForm');
        var editPriceId = document.getElementById('editPriceId');
        var editPriceInput = document.getElementById('editPriceInput');
        var cancelEditPrice = document.getElementById('cancelEditPrice');

        editButtons.forEach(function (button) {
            button.addEventListener('click', function () {
                var row = button.closest('tr');
                var priceCell = row.querySelector('td:nth-child(5)'); // Cột thứ 5 là cột giá bán
                var currentPrice = priceCell.textContent.trim();

                editPriceId.value = row.dataset.id;
                editPriceInput.value = currentPrice;
                editPriceInput.select();

                priceCell.appendChild(editPriceForm);
                editPriceForm.style.display = 'block';
                editPriceInput.focus();

                editPriceInput.addEventListener('keydown', function (event) {
                    if (event.key === 'Enter') {
                        editPriceForm.submit();
                    }
                });
            });
        });

        cancelEditPrice.addEventListener('click', function () {
            editPriceForm.style.display = 'none';
            document.body.appendChild(editPriceForm);
        });
    });

</script>
<!-- Script -->
<div>
    <script th:replace="/admin/fragments/script :: script"></script>
</div>

</body>
</html>
